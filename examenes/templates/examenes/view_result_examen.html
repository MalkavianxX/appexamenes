{% extends 'dashboard/dashboard.html' %}{% load static %}


{% block title %}
<title>Ad-mision| Dashboard - Mi resultado</title>

{% endblock %}
{% block descripcion %}
<meta name="description" content="Mi resultado, descubre cuanto obtuviste en tu examen.">
<meta name="author" content="Ad-mision s Team dev">
{% endblock %}

{% block content %}
<!-- App css -->
<link href="{% static 'login/assets/css/app-modern.min.css' %}" rel="stylesheet" type="text/css" id="app-style" />
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/contrib/auto-render.min.js"
    onload="renderMathInElement(document.body);"></script>
<style>
    .katex-display>.katex {
        white-space: normal
    }

    /* Add space between broken lines: */
    .katex-display>.base {
        margin: 0.25em 0
    }

    /* Compensate by reducing space around display math */
    .katex-display {
        margin: 0.5em 0;
    }

    .katex .mtable .col-align-r>.vlist-t {
        text-align: center !important;
    }
</style>
<!-- ============================================================== -->
<!-- Start Page Content here -->
<!-- ============================================================== -->
<input type="hidden" name="num_preguntas" value="{{resumen_data.num_preguntas}}" id="num_preguntas">
<div class="content-page">
    <div class="content">

        <!-- Start Content-->
        <div class="container-fluid">

            <div class="row">
                <div class="col-12">
                    <div class="page-title-box">
                        <div class="page-title-right">
                            <ol class="breadcrumb m-0">
                                <li class="breadcrumb-item"><a href="javascript: void(0);">Ad-min</a></li>
                                <li class="breadcrumb-item"><a href="javascript: void(0);">Dashboard</a></li>
                                <li class="breadcrumb-item active">Resultado</li>
                            </ol>
                        </div>
                        <h4 class="page-title">{{resumen_data.titulo_examen}}</h4>
                    </div>
                </div>
            </div>
            <input type="text" value="{{resumen_data.examen_resultado}}" id="examen_resultado" class="d-none">
            <div class="row justify-content-between">
                <div class="col-xl-6 col-lg-5 col-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-12">
                                    <div id="gradient-chart" class="apex-charts" data-colors="#8f75da,#727cf5"></div>
                                </div>
                            </div>

                        </div>
                        <!-- end card body-->
                    </div>
                    <div class="row">
                        <div class="col-lg-6 col-12">
                            <div class="card widget-flat">
                                <div class="card-body">
                                    <div class="float-end">
                                        <i class="mdi mdi-pulse widget-icon"></i>
                                    </div>
                                    <h5 class="text-muted fw-normal mt-0" title="Growth">Total de preguntas</h5>
                                    <h3 class="mt-3 mb-3">{{resumen_data.num_preguntas}} preguntas</h3>
                                    <p class="mb-0 text-muted">
                                        <span class="text-success me-2">
                                            <i class="mdi mdi-arrow-up-bold"></i> {{ resumen_data.prc_preguntas }}%</span>
                                        <span class="text-nowrap">Preguntas respondidas</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-12">
                            <div class="card widget-flat">
                                <div class="card-body">
                                    <div class="float-end">
                                        <i class="mdi mdi-timer-sand-complete widget-icon"></i>
                                    </div>
                                    <h5 class="text-muted fw-normal mt-0" title="Growth">Tiempo total</h5>
                                    <h3 class="mt-3 mb-3">{{ resumen_data.tiempo_total }} </h3>
                                    <p class="mb-0 text-muted">
                                        <span class="text-success me-2">
                                            <i class="mdi mdi-arrow-up-bold"></i>{{ resumen_data.prc_tiempo }}%</span>
                                        <span class="text-nowrap">Tiempo usado</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-12">
                            <div class="card widget-flat">
                                <div class="card-body">
                                    <div class="float-end">
                                        <i class="mdi mdi-timer-sand-complete widget-icon"></i>
                                    </div>
                                    <h5 class="text-muted fw-normal mt-0" title="Growth">Respuestas correctas</h5>
                                    <h3 class="mt-3 mb-3 text-success">{{ resumen_data.correctas }} </h3>

                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-12">
                            <div class="card widget-flat">
                                <div class="card-body">
                                    <div class="float-end">
                                        <i class="mdi mdi-timer-sand-complete widget-icon"></i>
                                    </div>
                                    <h5 class="text-muted fw-normal mt-0" title="Growth">Respuestas erroneas</h5>
                                    <h3 class="mt-3 mb-3 text-danger">{{ resumen_data.incorrectas }} </h3>

                                </div>
                            </div>
                        </div>

                        <div class="col-11 d-lg-none d-block mt-3 mb-3">
                            <div class="d-grid gap-2">
                                <a class="btn btn-primary" type="button"> <i class="mdi mdi-home"></i> Ir al inicio</a>
                              </div> 
                        </div>
                        <div class="col-lg-12 col-12">
                            <div class="card widget-flat">
                                <div class="card-body">
                                    <div class="float-end">
                                        <i class="mdi mdi-alert-outline widget-icon"></i>
                                    </div>
                                    <h4>¿Tuviste algun problema?</h4>
                                    <div class="mb-3 mt-2">
                                        <label for="example-textarea" class="form-label">Escribe lo sucedido</label>
                                        <textarea class="form-control" id="comentarios-reporte" rows="5"></textarea>
                                    </div>
                                    <div class="d-grid">
                                        <button type="submit" id="btn-enviar"
                                            class="btn btn-soft-primary rounded-pill">Enviar comentarios</button>
                                    </div>
                                    <!-- end d-grid -->
                                </div>
                            </div>
                        </div>

                    </div>
                    <!-- end card -->
                </div>
                <div class="col-xl-6 col-lg-7 col-12">
                    <div class="row">
                        <div class="col ">
                            <div class="py-0 mb-3 text-start" data-simplebar style="max-height: 80vh">
                                {% for resultado in resumen_data.resultados %}

                                <div class="card ribbon-box align-items-start mt-1 p-2 ">
                                    <div class="card-body w-100">
                                        {% if resultado.resultado == "Correcto" %}
                                        <div class="ribbon ribbon-success float-end"><i
                                                class="mdi mdi-check-bold me-1"></i> Correcta</div>
                                        {% elif resultado.resultado == "Vacio" %}
                                        <div class="ribbon ribbon-secondary float-end"><i
                                                class="mdi mdi-alert me-1"></i> Sin responder</div>
                                        {% else %}
                                        <div class="ribbon ribbon-danger float-end"><i
                                                class="mdi mdi-close-thick me-1"></i> Incorrecta</div>
                                        {% endif %}
                                        <h5 class="text-primary float-start mt-0">Pregunta {{ resultado.numero_pregunta }}</h5>
                                        <div class="ribbon-content">
                                            <div class="tab-content">
                                                <div class="tab-pane show active" id="justified-tabs-preview">
                                                    <ul class="nav nav-pills bg-nav-pills nav-justified mb-3">
                                                        <li class="nav-item">
                                                            <a href="#p{{resultado.numero_pregunta}}"
                                                                data-bs-toggle="tab" aria-expanded="false"
                                                                class="nav-link rounded-0 active">
                                                                <i class="mdi mdi-comment-text d-md-none d-block"></i>
                                                                <span class="d-none d-md-block">Pregunta</span>
                                                            </a>
                                                        </li>
                                                        <li class="nav-item">
                                                            <a href="#rs{{resultado.numero_pregunta}}"
                                                                data-bs-toggle="tab" aria-expanded="true"
                                                                class="nav-link rounded-0 ">
                                                                <i class="mdi mdi-comment-flash d-md-none d-block"></i>
                                                                <span class="d-none d-md-block">Tu respuesta</span>
                                                            </a>
                                                        </li>
                                                        <li class="nav-item">
                                                            <a href="#r{{resultado.numero_pregunta}}"
                                                                data-bs-toggle="tab" aria-expanded="false"
                                                                class="nav-link rounded-0">
                                                                <i class="mdi mdi-comment-check d-md-none d-block"></i>
                                                                <span class="d-none d-md-block">Respuesta
                                                                    correcta</span>
                                                            </a>
                                                        </li>
                                                    </ul>

                                                    <div class="tab-content">
                                                        <div class="tab-pane show active"
                                                            id="p{{resultado.numero_pregunta}}">
                                                            <p>{{ resultado.texto_pregunta }}</p>
                                                        </div>
                                                        <div class="tab-pane  " id="rs{{resultado.numero_pregunta}}">
                                                            <p>{{ resultado.texto_respuesta_seleccionada }}</p>
                                                        </div>
                                                        <div class="tab-pane" id="r{{resultado.numero_pregunta}}">
                                                            <p>{{ resultado.texto_respuesta_correcta }}</p>
                                                        </div>
                                                    </div>
                                                </div> <!-- end preview-->


                                            </div> <!-- end tab-content-->
                                        </div>
                                    </div> <!-- end card-body -->
                                </div> <!-- end card-->
                                {% endfor %}

                            </div>

                        </div>


                    </div>


                    <!-- end card -->
                </div>

            </div>
        </div>
    </div>
</div>
<!-- ============================================================== -->
<!-- End Page content -->
<!-- ============================================================== -->

<!-- Vendor js -->
<script src="{% static 'login/assets/js/vendor.min.js' %}"></script>

<!-- Apex Chart js -->
<script src="{% static 'login/assets/vendor/apexcharts/apexcharts.min.js' %}"></script>
<!-- Apex Chart RadialBar Demo js -->
<script src="{% static 'login/assets/js/pages/demo.apex-radialbar.js' %}"></script>
<!-- App js -->
<script src="{% static 'login/assets/js/app.min.js' %}"></script>
<script>
    const btn_comentario = document.getElementById('btn-enviar');
    const textarea = document.getElementById('comentarios-reporte');
    btn_comentario.addEventListener('click', function () {
        // Obtener el comentario del textarea
        const comentario = document.getElementById('comentarios-reporte').value;

        // Mostrar alerta de carga mientras se envía el comentario
        Swal.fire({
            title: 'Enviando...',
            text: 'Por favor espera mientras enviamos tu comentario.',
            allowOutsideClick: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });

        // Simular el envío del comentario al servidor
        fetch('/dashboardenviar_comentario', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ comentario: comentario })
        })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'ok') {
                    // Mostrar alerta de éxito
                    Swal.fire({
                        title: '¡Éxito!',
                        text: 'Tu comentario ha sido enviado correctamente.',
                        icon: 'success'
                    });
                    textarea.value = "";
                } else {
                    // Mostrar alerta de error
                    Swal.fire({
                        title: 'Error',
                        text: 'Hubo un problema al enviar tu comentario. Por favor, inténtalo de nuevo.',
                        icon: 'error'
                    });
                }
            })
            .catch(error => {
                // Mostrar alerta de error en caso de fallo en la petición
                Swal.fire({
                    title: 'Error',
                    text: 'Hubo un problema al enviar tu comentario. Por favor, inténtalo de nuevo.',
                    icon: 'error'
                });
            });
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            delimiters: [
                { left: "\\begin{align}", right: "\\end{align}", display: true }
            ],
            fleqn: false,  // Opcional: para alinear las ecuaciones a la izquierda
            leqno: false,   // Opcional: para poner los números de las ecuaciones a la izquierda
            displayMode: true
        });
        // Eliminar los números de las ecuaciones
        document.querySelectorAll('.eqn-num').forEach(function (eqnNum) {
            eqnNum.remove();
        });
    });


</script>
{% endblock %}